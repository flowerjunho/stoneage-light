# ë©€í‹°í”Œë ˆì´ì–´ ë¼ì§€ ë ˆì´ìŠ¤ API ëª…ì„¸ì„œ v3.0

## ê°œìš”

ë©€í‹°í”Œë ˆì´ì–´ ë¼ì§€ ë ˆì´ìŠ¤ ê²Œì„ì„ ìœ„í•œ ë°±ì—”ë“œ API ëª…ì„¸ì„œì…ë‹ˆë‹¤.
**ì‹¤ì‹œê°„ ë™ê¸°í™”ëŠ” SSE(Server-Sent Events) ë°©ì‹**ìœ¼ë¡œ êµ¬í˜„ë˜ë©°, í´ë§ ëŒ€ë¹„ ì„œë²„ ë¶€í•˜ 90% ê°ì†Œ ë° ì‹¤ì‹œê°„ ì‘ë‹µì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

## ê¸°ë³¸ ì •ë³´

| í•­ëª© | ê°’ |
|------|-----|
| Base URL | `/api/game` |
| Content-Type | `application/json` |
| SSE Content-Type | `text/event-stream` |
| ì €ì¥ ë°©ì‹ | JSON íŒŒì¼ (`game-rooms/` ë””ë ‰í† ë¦¬) |
| ê²Œì„ ëª¨ë“œ | `normal` (ì¼ë°˜ ë ˆì´ìŠ¤), `relay` (ë¦´ë ˆì´ ë ˆì´ìŠ¤) |
| ë ˆì´ìŠ¤ ëª¨ë“œ | `individual` (ê°œì¸ì „), `team` (íŒ€ì „) â­ NEW |

---

## ëª©ì°¨

1. [ê²Œì„ ëª¨ë“œ](#ê²Œì„-ëª¨ë“œ)
2. [ë°ì´í„° êµ¬ì¡°](#ë°ì´í„°-êµ¬ì¡°)
3. [REST API ì—”ë“œí¬ì¸íŠ¸](#rest-api-ì—”ë“œí¬ì¸íŠ¸)
4. [SSE ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¼](#sse-ì‹¤ì‹œê°„-ìŠ¤íŠ¸ë¦¼)
5. [CORS ì„¤ì •](#cors-ì„¤ì •)
6. [ì—ëŸ¬ ì½”ë“œ](#ì—ëŸ¬-ì½”ë“œ)
7. [ê²Œì„ íë¦„ë„](#ê²Œì„-íë¦„ë„)
8. [í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤](#í…ŒìŠ¤íŠ¸-ì‹œë‚˜ë¦¬ì˜¤)

---

## ê²Œì„ ëª¨ë“œ

### ì¼ë°˜ ëª¨ë“œ (normal)
- ê° í”Œë ˆì´ì–´ê°€ 1ë§ˆë¦¬ì”© ë¼ì§€ë¥¼ ì„ íƒí•˜ì—¬ ë ˆì´ìŠ¤
- ë¨¼ì € ê²°ìŠ¹ì„ ì— ë„ë‹¬í•˜ëŠ” ë¼ì§€ê°€ ìš°ìŠ¹
- í¸ë„ ë ˆì´ìŠ¤ (0 â†’ 100)

#### ë ˆì´ìŠ¤ ëª¨ë“œ (raceMode) â­ NEW

ì¼ë°˜ ëª¨ë“œ(`gameMode: normal`)ì—ì„œ ê°œì¸ì „/íŒ€ì „ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

| raceMode | ì„¤ëª… |
|----------|------|
| `individual` | **ê°œì¸ì „** (ê¸°ë³¸ê°’) - ê°ìì˜ ìˆœìœ„ ê²½ìŸ, ë¨¼ì € ë„ì°©í•˜ëŠ” ìˆœì„œëŒ€ë¡œ ìˆœìœ„ ê²°ì • |
| `team` | **íŒ€ì „** - AíŒ€ vs BíŒ€ ì ìˆ˜ ëŒ€ê²°, ë“±ìˆ˜ë³„ ì ìˆ˜ í•©ì‚°ìœ¼ë¡œ ìŠ¹íŒ¨ ê²°ì • |

**íŒ€ì „ ê·œì¹™:**
- í”Œë ˆì´ì–´ëŠ” AíŒ€ ë˜ëŠ” BíŒ€ì„ ì„ íƒí•´ì•¼ í•¨ (ê¸°ì¡´ `selectTeam` API ì‚¬ìš©)
- ê²Œì„ ì‹œì‘ ì „ ì–‘ íŒ€ì— ìµœì†Œ 1ëª…ì”© ì°¸ê°€ìê°€ ìˆì–´ì•¼ í•¨
- **ì–‘ íŒ€ ì¸ì›ìˆ˜ê°€ ë™ì¼í•´ì•¼ ê²Œì„ ì‹œì‘ ê°€ëŠ¥** (ê´€ì „ì ì œì™¸)
- íŒ€ì„ ì„ íƒí•˜ì§€ ì•Šìœ¼ë©´ ì¤€ë¹„ ì™„ë£Œ ë¶ˆê°€
- ì™„ì£¼ ë“±ìˆ˜ë³„ ì ìˆ˜: 1ë“±=10ì , 2ë“±=8ì , 3ë“±=6ì , 4ë“±=5ì , 5ë“±=4ì , 6ë“±=3ì , 7ë“±=2ì , 8ë“±ì´í•˜=1ì 
- íŒ€ ì´ì ì´ ë†’ì€ íŒ€ ìŠ¹ë¦¬ (ë™ì  ì‹œ 1ë“± ë³´ìœ íŒ€ ìŠ¹ë¦¬)

#### ë¦¬íƒ€ì´ì–´ ê·œì¹™ â­ NEW

1ë“±ì´ ê³¨ì¸í•œ í›„ **ì„œë²„ì—ì„œ ì„¤ì •í•œ ì‹œê°„(`retireThreshold`) ì´ë‚´**ì— ê²°ìŠ¹ì„ ì„ í†µê³¼í•˜ì§€ ëª»í•œ í”Œë ˆì´ì–´ëŠ” **ë¦¬íƒ€ì´ì–´(0ì )** ì²˜ë¦¬ë©ë‹ˆë‹¤.

**ë¦¬íƒ€ì´ì–´ ì²˜ë¦¬ íë¦„:**
```
1ë“± ê³¨ì¸ â†’ firstPlaceFinishTime ê¸°ë¡ â†’ retireThreshold ê¸°ì¤€ ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
         â†’ retireThreshold ê²½ê³¼ â†’ ë¯¸ì™„ì£¼ì ì „ì› ë¦¬íƒ€ì´ì–´ (rank: null, 0ì )
         â†’ ê²Œì„ ì¢…ë£Œ (status: finished)
```

**ë¦¬íƒ€ì´ì–´ íŒì •:**
| ì¡°ê±´ | ê²°ê³¼ |
|------|------|
| 1ë“± ê³¨ì¸ í›„ retireThreshold ì´ë‚´ ì™„ì£¼ | ì •ìƒ ìˆœìœ„ ë° ì ìˆ˜ ë¶€ì—¬ |
| 1ë“± ê³¨ì¸ í›„ retireThreshold ì´ˆê³¼ | ë¦¬íƒ€ì´ì–´ (rank: null, 0ì ) |

**í´ë¼ì´ì–¸íŠ¸ ì¹´ìš´íŠ¸ë‹¤ìš´ ê³„ì‚°:**
```typescript
// ì„œë²„ì—ì„œ ë°›ì€ firstPlaceFinishTime ë° retireThreshold ì‚¬ìš© (í•˜ë“œì½”ë”© ê¸ˆì§€!)
const RETIRE_TIMEOUT = room.retireThreshold || 10000; // ì„œë²„ ê°’ ì‚¬ìš© (ê¸°ë³¸ê°’: 10ì´ˆ)
const now = Date.now();
const elapsed = now - room.firstPlaceFinishTime;
const remainingSec = Math.ceil((RETIRE_TIMEOUT - elapsed) / 1000);

if (remainingSec > 0) {
  // ì¹´ìš´íŠ¸ë‹¤ìš´ UI í‘œì‹œ: remainingSec + "ì´ˆ"
} else {
  // ì¹´ìš´íŠ¸ë‹¤ìš´ ì¢…ë£Œ, ë¦¬íƒ€ì´ì–´ ì²˜ë¦¬ ëŒ€ê¸°
}
```

> **ì¤‘ìš”**:
> - `firstPlaceFinishTime`: 1ë“±ì´ ê³¨ì¸í•˜ëŠ” ìˆœê°„ ì„œë²„ì—ì„œ ê¸°ë¡ë˜ë©°, SSEë¥¼ í†µí•´ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „íŒŒë©ë‹ˆë‹¤.
> - `retireThreshold`: ì„œë²„ì—ì„œ ë°© ìƒì„± ì‹œ ì„¤ì •í•˜ëŠ” ë¦¬íƒ€ì´ì–´ ê¸°ì¤€ ì‹œê°„(ms). í´ë¼ì´ì–¸íŠ¸ëŠ” ë°˜ë“œì‹œ ì´ ê°’ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
> - **í´ë¼ì´ì–¸íŠ¸ëŠ” ë¦¬íƒ€ì´ì–´ ì‹œê°„ì„ í•˜ë“œì½”ë”©í•˜ì§€ ë§ê³  ë°˜ë“œì‹œ `room.retireThreshold` ê°’ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.**

### ë¦´ë ˆì´ ëª¨ë“œ (relay)
- íŒ€ ëŒ€í•­ì „ (AíŒ€ vs BíŒ€)
- ê° íŒ€ì— ë¼ì§€ 1ë§ˆë¦¬ì”© (ì´ 2ë§ˆë¦¬ ê³ ì •)
- **ì™•ë³µ ë ˆì´ìŠ¤**: ì¶œë°œ â†’ ê²°ìŠ¹ì„  â†’ ì¶œë°œì  ë³µê·€
- í•œ ì£¼ìê°€ ì™•ë³µ ì™„ë£Œí•˜ë©´ ë‹¤ìŒ ì£¼ìê°€ ì¶œë°œ
- ë§ˆì§€ë§‰ ì£¼ìê°€ ë¨¼ì € ë³µê·€í•˜ëŠ” íŒ€ ìŠ¹ë¦¬

> **ì°¸ê³ **: ë¦´ë ˆì´ ëª¨ë“œì—ì„œëŠ” `raceMode`ê°€ ë¬´ì‹œë©ë‹ˆë‹¤. ë¦´ë ˆì´ ëª¨ë“œëŠ” í•­ìƒ íŒ€ ëŒ€í•­ì „ì…ë‹ˆë‹¤.

**ë¦´ë ˆì´ ë ˆì´ìŠ¤ íë¦„:**
```
1ë²ˆ ì£¼ì: 0 â†’ 100 â†’ 0 (ì™•ë³µ ì™„ë£Œ) â†’ 2ë²ˆ ì£¼ìì—ê²Œ ë°”í†µ ì „ë‹¬
2ë²ˆ ì£¼ì: 0 â†’ 100 â†’ 0 (ì™•ë³µ ì™„ë£Œ) â†’ 3ë²ˆ ì£¼ìì—ê²Œ ë°”í†µ ì „ë‹¬
...
ë§ˆì§€ë§‰ ì£¼ì: 0 â†’ 100 â†’ 0 (ì™•ë³µ ì™„ë£Œ) â†’ íŒ€ ì™„ì£¼!
```

---

## ë°ì´í„° êµ¬ì¡°

### Player (í”Œë ˆì´ì–´)

```typescript
interface Player {
  id: string;                    // í”Œë ˆì´ì–´ ê³ ìœ  ID (í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìƒì„±)
  name: string;                  // ë‹‰ë„¤ì„ (2-10ì)
  selectedPig: number | null;    // ì„ íƒí•œ ë¼ì§€ ìƒ‰ìƒ ë²ˆí˜¸ (0-29, nullì´ë©´ ë¯¸ì„ íƒ)
  isReady: boolean;              // ì¤€ë¹„ ì™„ë£Œ ì—¬ë¶€
  isSpectator: boolean;          // ê´€ì „ì ì—¬ë¶€
  team: 'A' | 'B' | null;        // ë¦´ë ˆì´ ëª¨ë“œ: ì†Œì† íŒ€
  runnerOrder: number | null;    // ë¦´ë ˆì´ ëª¨ë“œ: ì£¼ì ìˆœì„œ (1, 2, 3...)
  joinedAt: number;              // ì…ì¥ ì‹œê°„ (Unix timestamp ms)
}
```

### PigState (ì¼ë°˜ ëª¨ë“œ ë¼ì§€ ìƒíƒœ)

```typescript
interface PigState {
  id: number;                    // ë¼ì§€ ë²ˆí˜¸ (0 ~ í”Œë ˆì´ì–´ìˆ˜-1, ë™ì ìœ¼ë¡œ ì¦ê°)
  position: number;              // í˜„ì¬ ìœ„ì¹˜ (0-100, 100ì´ë©´ ì™„ì£¼)
  speed: number;                 // í˜„ì¬ ì†ë„
  status: PigStatus;             // í˜„ì¬ ìƒíƒœ
  finishTime: number | null;     // ì™„ì£¼ ì‹œê°„ (ms), nullì´ë©´ ë¯¸ì™„ì£¼
  rank: number | null;           // ìˆœìœ„, nullì´ë©´ ë¯¸ì™„ì£¼
}

type PigStatus = 'normal' | 'boost' | 'superBoost' | 'turbo' | 'tired' | 'slip';
```

**ìƒíƒœ ì„¤ëª…:**
| status | ì„¤ëª… | ì†ë„ ë°°ìœ¨ |
|--------|------|----------|
| normal | ì¼ë°˜ | 1.0x |
| boost | ë¶€ìŠ¤íŠ¸ | 1.8x |
| superBoost | ìŠˆí¼ ë¶€ìŠ¤íŠ¸ | 2.5x |
| turbo | í„°ë³´ | 4.0x |
| tired | ì§€ì¹¨ | 0.2x |
| slip | ë¯¸ë„ëŸ¬ì§ | 0.05x |

### RelayPigState (ë¦´ë ˆì´ ëª¨ë“œ ë¼ì§€ ìƒíƒœ) â­ NEW

```typescript
interface RelayPigState {
  id: number;                    // ë¼ì§€ ë²ˆí˜¸ (0: AíŒ€, 1: BíŒ€)
  team: 'A' | 'B';               // ì†Œì† íŒ€
  position: number;              // í˜„ì¬ ìœ„ì¹˜ (0-100)
  speed: number;                 // í˜„ì¬ ì†ë„
  status: PigStatus;             // í˜„ì¬ ìƒíƒœ
  direction: 'forward' | 'backward'; // ì´ë™ ë°©í–¥ (forward: 0â†’100, backward: 100â†’0)
  finishTime: number | null;     // íŒ€ ìµœì¢… ì™„ì£¼ ì‹œê°„
  rank: number | null;           // íŒ€ ìˆœìœ„ (1ë“± ë˜ëŠ” 2ë“±)
}
```

> **ì¼ë°˜ ëª¨ë“œ**: ë¼ì§€ ìˆ˜ = ì°¸ê°€ì ìˆ˜ (ë™ì  ì¦ê°)
> **ë¦´ë ˆì´ ëª¨ë“œ**: ë¼ì§€ ìˆ˜ = 2ë§ˆë¦¬ (íŒ€ë‹¹ 1ë§ˆë¦¬, ê³ ì •)

### RelayState (ë¦´ë ˆì´ ëª¨ë“œ ì „ìš©) â­ NEW

```typescript
interface RelayState {
  teamA: TeamRelayState;
  teamB: TeamRelayState;
}

interface TeamRelayState {
  currentRunner: number;         // í˜„ì¬ ë‹¬ë¦¬ëŠ” ì£¼ì ìˆœì„œ (1ë¶€í„° ì‹œì‘)
  completedRunners: number;      // ì™„ì£¼í•œ ì£¼ì ìˆ˜
  totalRunners: number;          // ì´ ì£¼ì ìˆ˜
  finishTime: number | null;     // íŒ€ ì™„ì£¼ ì‹œê°„
}
```

### TeamScoreState (íŒ€ì „ ì ìˆ˜ ìƒíƒœ) â­ NEW

```typescript
interface TeamScoreState {
  teamA: number;                 // AíŒ€ ì´ì 
  teamB: number;                 // BíŒ€ ì´ì 
}
```

### GameRoom (ê²Œì„ ë°©)

```typescript
interface GameRoom {
  roomCode: string;              // 6ìë¦¬ ë°© ì½”ë“œ (ì˜ˆ: "A1B2C3")
  hostId: string;                // ë°©ì¥ í”Œë ˆì´ì–´ ID
  gameMode: 'normal' | 'relay';  // â­ ê²Œì„ ëª¨ë“œ
  raceMode: 'individual' | 'team'; // â­ NEW: ë ˆì´ìŠ¤ ëª¨ë“œ (ì¼ë°˜ ëª¨ë“œì—ì„œ ê°œì¸ì „/íŒ€ì „ êµ¬ë¶„)
  status: GameStatus;            // ê²Œì„ ìƒíƒœ
  players: Player[];             // ì°¸ê°€ì ëª©ë¡ (ìµœëŒ€ 30ëª…)
  pigs: PigState[] | RelayPigState[]; // ë¼ì§€ ìƒíƒœ
  maxPlayers: number;            // ìµœëŒ€ ì¸ì› (2-30)
  raceStartTime: number | null;  // ë ˆì´ìŠ¤ ì‹œì‘ ì‹œê°„
  raceEndTime: number | null;    // ë ˆì´ìŠ¤ ì¢…ë£Œ ì‹œê°„
  countdown: number;             // ì¹´ìš´íŠ¸ë‹¤ìš´ (3, 2, 1, 0)
  relay: RelayState | null;      // â­ ë¦´ë ˆì´ ëª¨ë“œ ì „ìš© ìƒíƒœ (ì¼ë°˜ ëª¨ë“œë©´ null)
  teamScore: TeamScoreState | null; // â­ NEW: íŒ€ì „ ëª¨ë“œ ì ìˆ˜ (ê°œì¸ì „ì´ë©´ null)
  firstPlaceFinishTime: number | null; // â­ NEW: 1ë“± ê³¨ì¸ ì‹œê°„ (Unix timestamp ms), ë¦¬íƒ€ì´ì–´ ì¹´ìš´íŠ¸ë‹¤ìš´ìš©
  retireThreshold: number;       // â­ NEW: ë¦¬íƒ€ì´ì–´ ê¸°ì¤€ ì‹œê°„ (ë°€ë¦¬ì´ˆ), ì„œë²„ì—ì„œ ì„¤ì • (ê¸°ë³¸ê°’: 10000)
  createdAt: number;             // ë°© ìƒì„± ì‹œê°„
  updatedAt: number;             // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
}

type GameStatus = 'waiting' | 'selecting' | 'countdown' | 'racing' | 'finished';
type RaceMode = 'individual' | 'team'; // â­ NEW
```

**ë ˆì´ìŠ¤ ëª¨ë“œ ì„¤ëª…:**
| raceMode | ì„¤ëª… |
|----------|------|
| `individual` | ê°œì¸ì „ - ê°ìì˜ ìˆœìœ„ ê²½ìŸ (ê¸°ë³¸ê°’) |
| `team` | íŒ€ì „ - AíŒ€ vs BíŒ€ ì ìˆ˜ ëŒ€ê²° |

**íŒ€ì „ ì ìˆ˜ ê³„ì‚°:**
| ë“±ìˆ˜ | ì ìˆ˜ |
|------|------|
| 1ë“± | 10ì  |
| 2ë“± | 8ì  |
| 3ë“± | 6ì  |
| 4ë“± | 5ì  |
| 5ë“± | 4ì  |
| 6ë“± | 3ì  |
| 7ë“± | 2ì  |
| 8ë“± ì´í•˜ | 1ì  |

### ApiResponse (API ì‘ë‹µ)

```typescript
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
}
```

---

## REST API ì—”ë“œí¬ì¸íŠ¸

### 1. ë°© ìƒì„±

ìƒˆ ê²Œì„ ë°©ì„ ë§Œë“¤ê³  ë°©ì¥ì´ ë©ë‹ˆë‹¤.

```
POST /api/game/rooms
```

**Request Body:**
```json
{
  "playerId": "player_1704067200000_abc123",
  "playerName": "ë‹‰ë„¤ì„",
  "maxPlayers": 6,
  "gameMode": "normal",
  "raceMode": "individual"
}
```

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|------|------|:----:|------|
| playerId | string | O | í”Œë ˆì´ì–´ ê³ ìœ  ID |
| playerName | string | O | ë‹‰ë„¤ì„ (2-10ì) |
| maxPlayers | number | X | ìµœëŒ€ ì¸ì› (ê¸°ë³¸ê°’: 6, ë²”ìœ„: 2-30) |
| gameMode | string | X | ê²Œì„ ëª¨ë“œ: `normal` (ê¸°ë³¸ê°’) ë˜ëŠ” `relay` |
| raceMode | string | X | â­ **NEW** ë ˆì´ìŠ¤ ëª¨ë“œ: `individual` (ê¸°ë³¸ê°’) ë˜ëŠ” `team` (ì¼ë°˜ ëª¨ë“œì—ì„œë§Œ ì‚¬ìš©) |

> **ì¤‘ìš”**: `raceMode`ëŠ” `gameMode`ê°€ `normal`ì¼ ë•Œë§Œ ìœ íš¨í•©ë‹ˆë‹¤. `relay` ëª¨ë“œì—ì„œëŠ” ë¬´ì‹œë©ë‹ˆë‹¤.

**Response 200 (ì¼ë°˜ ëª¨ë“œ - ê°œì¸ì „):**
```json
{
  "success": true,
  "data": {
    "roomCode": "A1B2C3",
    "hostId": "player_1704067200000_abc123",
    "gameMode": "normal",
    "raceMode": "individual",
    "status": "waiting",
    "players": [
      {
        "id": "player_1704067200000_abc123",
        "name": "ë‹‰ë„¤ì„",
        "selectedPig": null,
        "isReady": false,
        "isSpectator": false,
        "team": null,
        "runnerOrder": null,
        "joinedAt": 1704067200000
      }
    ],
    "pigs": [
      {"id": 0, "position": 0, "speed": 0, "status": "normal", "finishTime": null, "rank": null}
    ],
    "maxPlayers": 6,
    "raceStartTime": null,
    "raceEndTime": null,
    "countdown": 3,
    "relay": null,
    "teamScore": null,
    "createdAt": 1704067200000,
    "updatedAt": 1704067200000
  }
}
```

**Response 200 (ì¼ë°˜ ëª¨ë“œ - íŒ€ì „):** â­ NEW
```json
{
  "success": true,
  "data": {
    "roomCode": "A1B2C3",
    "hostId": "player_1704067200000_abc123",
    "gameMode": "normal",
    "raceMode": "team",
    "status": "waiting",
    "players": [...],
    "pigs": [...],
    "maxPlayers": 6,
    "raceStartTime": null,
    "raceEndTime": null,
    "countdown": 3,
    "relay": null,
    "teamScore": null,
    "createdAt": 1704067200000,
    "updatedAt": 1704067200000
  }
}
```

**Response 200 (ë¦´ë ˆì´ ëª¨ë“œ):**
```json
{
  "success": true,
  "data": {
    "roomCode": "A1B2C3",
    "hostId": "player_1704067200000_abc123",
    "gameMode": "relay",
    "status": "waiting",
    "players": [...],
    "pigs": [
      {"id": 0, "team": "A", "position": 0, "speed": 0, "status": "normal", "direction": "forward", "finishTime": null, "rank": null},
      {"id": 1, "team": "B", "position": 0, "speed": 0, "status": "normal", "direction": "forward", "finishTime": null, "rank": null}
    ],
    "relay": {
      "teamA": {"currentRunner": 1, "completedRunners": 0, "totalRunners": 0, "finishTime": null},
      "teamB": {"currentRunner": 1, "completedRunners": 0, "totalRunners": 0, "finishTime": null}
    },
    ...
  }
}
```

> **ì¼ë°˜ ëª¨ë“œ**: ë°©ì¥ 1ëª…ì´ë¯€ë¡œ ë¼ì§€ 1ë§ˆë¦¬ ìƒì„±, ì…ì¥/í‡´ì¥ ì‹œ ë™ì  ì¦ê°
> **ë¦´ë ˆì´ ëª¨ë“œ**: ë¼ì§€ 2ë§ˆë¦¬ ê³ ì • (íŒ€ë‹¹ 1ë§ˆë¦¬), ì…ì¥/í‡´ì¥í•´ë„ ë³€í™” ì—†ìŒ

**Response 400:**
```json
{"success": false, "error": "í”Œë ˆì´ì–´ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤."}
{"success": false, "error": "ë‹‰ë„¤ì„ì€ 2-10ì ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤."}
{"success": false, "error": "ê²Œì„ ëª¨ë“œëŠ” normal ë˜ëŠ” relayë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."}
```

---

### 2. ë°© ì…ì¥

ê¸°ì¡´ ë°©ì— ì°¸ê°€í•©ë‹ˆë‹¤. ê´€ì „ìë¡œ ì…ì¥í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

```
POST /api/game/rooms/:roomCode/join
```

**URL Parameters:**
| íŒŒë¼ë¯¸í„° | ì„¤ëª… |
|----------|------|
| roomCode | 6ìë¦¬ ë°© ì½”ë“œ (ëŒ€ì†Œë¬¸ì ë¬´ê´€) |

**Request Body:**
```json
{
  "playerId": "player_1704067260000_xyz789",
  "playerName": "ì°¸ê°€ì",
  "isSpectator": false
}
```

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|------|------|:----:|------|
| playerId | string | O | í”Œë ˆì´ì–´ ê³ ìœ  ID |
| playerName | string | O | ë‹‰ë„¤ì„ (2-10ì) |
| isSpectator | boolean | X | ê´€ì „ì ì—¬ë¶€ (ê¸°ë³¸ê°’: false) |

**Response 200:**
```json
{
  "success": true,
  "data": { /* GameRoom ê°ì²´ (playersì— ìƒˆ í”Œë ˆì´ì–´ ì¶”ê°€ë¨) */ }
}
```

> - **ì°¸ê°€ì**ë¡œ ì…ì¥ ì‹œ ë¼ì§€ë„ 1ë§ˆë¦¬ ì¶”ê°€ë©ë‹ˆë‹¤.
> - **ê´€ì „ì**ë¡œ ì…ì¥ ì‹œ ë¼ì§€ëŠ” ì¶”ê°€ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê´€ì „ìëŠ” ë¼ì§€ ì„ íƒ/ì¤€ë¹„ê°€ ë¶ˆê°€í•©ë‹ˆë‹¤.

**Response 404:**
```json
{"success": false, "error": "ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}
```

**Response 409:**
```json
{"success": false, "error": "ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤."}
{"success": false, "error": "ê²Œì„ì´ ì´ë¯¸ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤."}
```

---

### 3. ë°© í‡´ì¥

ë°©ì—ì„œ ë‚˜ê°‘ë‹ˆë‹¤. ë°©ì¥ì´ ë‚˜ê°€ë©´ ë‹¤ìŒ ì°¸ê°€ìê°€ ë°©ì¥ì´ ë©ë‹ˆë‹¤.

```
POST /api/game/rooms/:roomCode/leave
```

**Request Body:**
```json
{
  "playerId": "player_1704067260000_xyz789"
}
```

**Response 200:**
```json
{"success": true, "data": {"message": "ë°©ì—ì„œ ë‚˜ê°”ìŠµë‹ˆë‹¤."}}
```

ë§ˆì§€ë§‰ í”Œë ˆì´ì–´ê°€ ë‚˜ê°€ë©´:
```json
{"success": true, "data": {"message": "ë°©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."}}
```

---

### 4. í”Œë ˆì´ì–´ ê°•í‡´ (ë°©ì¥ ì „ìš©)

ë°©ì¥ì´ ì¤€ë¹„í•˜ì§€ ì•Šì€ í”Œë ˆì´ì–´ ë“±ì„ ê°•í‡´í•©ë‹ˆë‹¤. ëŒ€ê¸°/ì„ íƒ ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.

```
POST /api/game/rooms/:roomCode/kick
```

**Request Body:**
```json
{
  "playerId": "player_1704067200000_abc123",
  "targetPlayerId": "player_1704067260000_xyz789"
}
```

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| playerId | string | ë°©ì¥ì˜ í”Œë ˆì´ì–´ ID |
| targetPlayerId | string | ê°•í‡´í•  í”Œë ˆì´ì–´ì˜ ID |

**Response 200:**
```json
{
  "success": true,
  "message": "ë‹‰ë„¤ì„ë‹˜ì„ ê°•í‡´í–ˆìŠµë‹ˆë‹¤.",
  "data": { /* GameRoom ê°ì²´ */ }
}
```

**Response 403:**
```json
{"success": false, "error": "ë°©ì¥ë§Œ ê°•í‡´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."}
```

**Response 409:**
```json
{"success": false, "error": "ê²Œì„ ì¤‘ì—ëŠ” ê°•í‡´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}
```

> ê°•í‡´ëœ í”Œë ˆì´ì–´ëŠ” `kicked` SSE ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤.

---

### 5. ë°© ìƒíƒœ ì¡°íšŒ

í˜„ì¬ ë°© ìƒíƒœë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤. (SSE ì—°ê²° ì „ ì´ˆê¸° ìƒíƒœ í™•ì¸ìš©)

```
GET /api/game/rooms/:roomCode
```

**Response 200:**
```json
{
  "success": true,
  "data": { /* GameRoom ê°ì²´ */ }
}
```

**Response 404:**
```json
{"success": false, "error": "ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}
```

---

### 6. íŒ€ ì„ íƒ (ë¦´ë ˆì´ ëª¨ë“œ ì „ìš©) â­ NEW

ë¦´ë ˆì´ ëª¨ë“œì—ì„œ AíŒ€ ë˜ëŠ” BíŒ€ì„ ì„ íƒí•©ë‹ˆë‹¤.

```
POST /api/game/rooms/:roomCode/select-team
```

**Request Body:**
```json
{
  "playerId": "player_1704067200000_abc123",
  "team": "A"
}
```

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|------|------|:----:|------|
| playerId | string | O | í”Œë ˆì´ì–´ ID |
| team | string | O | ì„ íƒí•  íŒ€: `"A"` ë˜ëŠ” `"B"` |

**Response 200:**
```json
{
  "success": true,
  "data": { /* GameRoom ê°ì²´ (í•´ë‹¹ í”Œë ˆì´ì–´ì˜ teamì´ ë³€ê²½ë¨) */ }
}
```

**Response 400:**
```json
{"success": false, "error": "íŒ€ì€ A ë˜ëŠ” Bë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."}
```

**Response 409:**
```json
{"success": false, "error": "ë¦´ë ˆì´ ëª¨ë“œì—ì„œë§Œ íŒ€ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."}
{"success": false, "error": "ëŒ€ê¸° ì¤‘ì¼ ë•Œë§Œ íŒ€ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."}
{"success": false, "error": "ê´€ì „ìëŠ” íŒ€ì„ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}
```

> **íŒ€ ë³€ê²½ ì‹œ ì£¼ì ìˆœì„œ ìë™ ì´ˆê¸°í™”**: íŒ€ì„ ë³€ê²½í•˜ë©´ ê¸°ì¡´ runnerOrderê°€ `null`ë¡œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.

---

### 7. ì£¼ì ìˆœì„œ ì¼ê´„ ë°°ì • (ë°©ì¥ ì „ìš©, ë¦´ë ˆì´ ëª¨ë“œ) â­ NEW

ë¦´ë ˆì´ ëª¨ë“œì—ì„œ ë°©ì¥ì´ ê²Œì„ ì‹œì‘ ì „ ëª¨ë“  í”Œë ˆì´ì–´ì˜ ì£¼ì ìˆœì„œë¥¼ í•œë²ˆì— ë°°ì •í•©ë‹ˆë‹¤.
í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ëœë¤ ìˆœì„œë¥¼ ìƒì„±í•˜ì—¬ ì´ APIë¡œ ì¼ê´„ ë°°ì •í•©ë‹ˆë‹¤.

```
POST /api/game/rooms/:roomCode/assign-runner-orders
```

**Request Body:**
```json
{
  "playerId": "player_1704067200000_abc123",
  "assignments": [
    { "playerId": "player_a", "order": 1 },
    { "playerId": "player_b", "order": 2 },
    { "playerId": "player_c", "order": 1 },
    { "playerId": "player_d", "order": 2 }
  ]
}
```

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|------|------|:----:|------|
| playerId | string | O | ë°©ì¥ì˜ í”Œë ˆì´ì–´ ID |
| assignments | array | O | í”Œë ˆì´ì–´ë³„ ì£¼ì ìˆœì„œ ë°°ì—´ |
| assignments[].playerId | string | O | ëŒ€ìƒ í”Œë ˆì´ì–´ ID |
| assignments[].order | number | O | ì£¼ì ìˆœì„œ (1ë¶€í„° ì‹œì‘) |

**Response 200:**
```json
{
  "success": true,
  "data": { /* GameRoom ê°ì²´ (ëª¨ë“  í”Œë ˆì´ì–´ì˜ runnerOrderê°€ ë°°ì •ë¨) */ }
}
```

**Response 403:**
```json
{"success": false, "error": "ë°©ì¥ë§Œ ì£¼ì ìˆœì„œë¥¼ ë°°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."}
```

**Response 409:**
```json
{"success": false, "error": "ë¦´ë ˆì´ ëª¨ë“œì—ì„œë§Œ ì£¼ì ìˆœì„œë¥¼ ë°°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."}
{"success": false, "error": "ëŒ€ê¸° ì¤‘ì¼ ë•Œë§Œ ì£¼ì ìˆœì„œë¥¼ ë°°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."}
```

**Response 422:**
```json
{"success": false, "error": "ê°™ì€ íŒ€ ë‚´ì—ì„œ ìˆœì„œê°€ ì¤‘ë³µë˜ì—ˆìŠµë‹ˆë‹¤."}
{"success": false, "error": "AíŒ€ì˜ ì£¼ì ìˆœì„œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. 1ë¶€í„° ì—°ì†ëœ ë²ˆí˜¸ì—¬ì•¼ í•©ë‹ˆë‹¤."}
```

**ì„œë²„ êµ¬í˜„ ìš”êµ¬ì‚¬í•­:**
1. `playerId`ê°€ ë°©ì¥(`hostId`)ì¸ì§€ ê²€ì¦
2. `gameMode`ê°€ `relay`ì¸ì§€ ê²€ì¦
3. `status`ê°€ `waiting`ì¸ì§€ ê²€ì¦
4. ê° í”Œë ˆì´ì–´ê°€ ë°©ì— ì¡´ì¬í•˜ëŠ”ì§€ ê²€ì¦
5. ê° í”Œë ˆì´ì–´ì˜ `runnerOrder` í•„ë“œë¥¼ ì—…ë°ì´íŠ¸
6. ê°™ì€ íŒ€ ë‚´ì—ì„œ ìˆœì„œ ì¤‘ë³µ ê²€ì¦
7. ê° íŒ€ì˜ ìˆœì„œê°€ 1ë¶€í„° ì—°ì†ë˜ì–´ì•¼ í•¨ ê²€ì¦ (ì˜ˆ: 1,2,3 âœ“ / 1,3 âœ—)

**ì„œë²„ êµ¬í˜„ ì˜ˆì‹œ:**
```javascript
function assignRunnerOrders(roomCode, playerId, assignments) {
  const room = getRoom(roomCode);
  if (!room) throw new NotFoundError('ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

  // 1. ê¶Œí•œ í™•ì¸ (ë°©ì¥ë§Œ)
  if (room.hostId !== playerId) {
    throw new ForbiddenError('ë°©ì¥ë§Œ ì£¼ì ìˆœì„œë¥¼ ë°°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
  }

  // 2. ê²Œì„ ëª¨ë“œ í™•ì¸
  if (room.gameMode !== 'relay') {
    throw new ConflictError('ë¦´ë ˆì´ ëª¨ë“œì—ì„œë§Œ ì£¼ì ìˆœì„œë¥¼ ë°°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
  }

  // 3. ìƒíƒœ í™•ì¸
  if (room.status !== 'waiting') {
    throw new ConflictError('ëŒ€ê¸° ì¤‘ì¼ ë•Œë§Œ ì£¼ì ìˆœì„œë¥¼ ë°°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
  }

  // 4. ë°°ì • ì ìš©
  const teamAOrders = [];
  const teamBOrders = [];

  for (const assignment of assignments) {
    const player = room.players.find(p => p.id === assignment.playerId);
    if (!player) {
      throw new NotFoundError(`í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${assignment.playerId}`);
    }

    player.runnerOrder = assignment.order;

    // íŒ€ë³„ ìˆœì„œ ìˆ˜ì§‘ (ê²€ì¦ìš©)
    if (player.team === 'A') teamAOrders.push(assignment.order);
    if (player.team === 'B') teamBOrders.push(assignment.order);
  }

  // 5. ìˆœì„œ ì—°ì†ì„± ê²€ì¦
  const validateOrders = (orders, teamName) => {
    if (orders.length === 0) return;
    orders.sort((a, b) => a - b);
    for (let i = 0; i < orders.length; i++) {
      if (orders[i] !== i + 1) {
        throw new UnprocessableError(
          `${teamName}íŒ€ì˜ ì£¼ì ìˆœì„œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. 1ë¶€í„° ì—°ì†ëœ ë²ˆí˜¸ì—¬ì•¼ í•©ë‹ˆë‹¤.`
        );
      }
    }
  };

  validateOrders(teamAOrders, 'A');
  validateOrders(teamBOrders, 'B');

  room.updatedAt = Date.now();
  saveRoom(roomCode, room);
  emitRoomEvent(roomCode, room);

  return room;
}
```

---

### 8. ë¼ì§€(ìƒ‰ìƒ) ì„ íƒ

í”Œë ˆì´ì–´ê°€ ë¼ì§€ ìƒ‰ìƒì„ ì„ íƒí•©ë‹ˆë‹¤. **ê°™ì€ ë¼ì§€ë¥¼ ë‹¤ì‹œ ì„ íƒí•˜ë©´ ì„ íƒì´ í•´ì œë©ë‹ˆë‹¤ (í† ê¸€).**

ì¼ë°˜ ëª¨ë“œì—ì„œëŠ” ë¼ì§€ ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ê³ , ë¦´ë ˆì´ ëª¨ë“œì—ì„œëŠ” ë¼ì§€ ìƒ‰ìƒë§Œ ì„ íƒí•©ë‹ˆë‹¤.

```
POST /api/game/rooms/:roomCode/select-pig
```

**Request Body:**
```json
{
  "playerId": "player_1704067200000_abc123",
  "pigId": 3
}
```

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| playerId | string | í”Œë ˆì´ì–´ ID |
| pigId | number | ë¼ì§€ ë²ˆí˜¸ (ì¼ë°˜: 0~í”Œë ˆì´ì–´ìˆ˜-1, ë¦´ë ˆì´: ìƒ‰ìƒ ë²ˆí˜¸ 0-29) |

**ë™ì‘ ë°©ì‹:**
- **ìƒˆ ë¼ì§€ ì„ íƒ**: `selectedPig`ê°€ í•´ë‹¹ ë²ˆí˜¸ë¡œ ì„¤ì •ë¨
- **ê°™ì€ ë¼ì§€ ì¬ì„ íƒ**: `selectedPig`ê°€ `null`ë¡œ ì„¤ì •ë¨ (ì„ íƒ í•´ì œ)
- **ë‹¤ë¥¸ ë¼ì§€ë¡œ ë³€ê²½**: ê¸°ì¡´ ì„ íƒ í•´ì œ í›„ ìƒˆ ë¼ì§€ ì„ íƒ

**Response 200:**
```json
{
  "success": true,
  "data": { /* GameRoom ê°ì²´ (í•´ë‹¹ í”Œë ˆì´ì–´ì˜ selectedPigê°€ ë³€ê²½ë¨) */ }
}
```

**Response 400:**
```json
{"success": false, "error": "ì˜ëª»ëœ ë¼ì§€ ë²ˆí˜¸ì…ë‹ˆë‹¤."}
```

**Response 409:**
```json
{"success": false, "error": "ì´ë¯¸ ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ ì„ íƒí•œ ë¼ì§€ì…ë‹ˆë‹¤."}
{"success": false, "error": "ë¼ì§€ë¥¼ ì„ íƒí•  ìˆ˜ ì—†ëŠ” ìƒíƒœì…ë‹ˆë‹¤."}
```

---

### 9. ì¤€ë¹„ ì™„ë£Œ/í•´ì œ

ì¤€ë¹„ ìƒíƒœë¥¼ í† ê¸€í•©ë‹ˆë‹¤. ë°©ì¥ì€ í•­ìƒ ì¤€ë¹„ ìƒíƒœì…ë‹ˆë‹¤.

> **ì°¸ê°€ì, ê´€ì „ì ëª¨ë‘ ì¤€ë¹„ ê°€ëŠ¥**í•©ë‹ˆë‹¤. ë¼ì§€ë¥¼ ì„ íƒí•˜ì§€ ì•Šì•„ë„ ì¤€ë¹„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
POST /api/game/rooms/:roomCode/ready
```

**Request Body:**
```json
{
  "playerId": "player_1704067260000_xyz789"
}
```

**Response 200:**
```json
{
  "success": true,
  "data": { /* GameRoom ê°ì²´ (í•´ë‹¹ í”Œë ˆì´ì–´ì˜ isReadyê°€ í† ê¸€ë¨) */ }
}
```

**Response 409:**
```json
{"success": false, "error": "ì¤€ë¹„ ìƒíƒœë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}
```

---

### 10. ê²Œì„ ì‹œì‘ (ë°©ì¥ ì „ìš©)

ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤. ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì¤€ë¹„ ì™„ë£Œí•´ì•¼ í•©ë‹ˆë‹¤.

```
POST /api/game/rooms/:roomCode/start
```

**Request Body:**
```json
{
  "playerId": "player_1704067200000_abc123"
}
```

**Response 200:**
```json
{
  "success": true,
  "data": { /* GameRoom ê°ì²´ (status: "countdown", countdown: 3) */ }
}
```

**Response 403:**
```json
{"success": false, "error": "ë°©ì¥ë§Œ ê²Œì„ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."}
```

**Response 409:**
```json
{"success": false, "error": "ê²Œì„ì„ ì‹œì‘í•  ìˆ˜ ì—†ëŠ” ìƒíƒœì…ë‹ˆë‹¤."}
```

**Response 422 (ê³µí†µ):**
```json
{"success": false, "error": "ìµœì†Œ 2ëª…ì˜ í”Œë ˆì´ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤."}
{"success": false, "error": "ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì¤€ë¹„ë¥¼ ì™„ë£Œí•´ì•¼ í•©ë‹ˆë‹¤."}
```

**Response 422 (ë¦´ë ˆì´ ëª¨ë“œ ì „ìš©):**
```json
{"success": false, "error": "ê° íŒ€ì— ìµœì†Œ 1ëª…ì˜ í”Œë ˆì´ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤."}
{"success": false, "error": "ëª¨ë“  ì°¸ê°€ìê°€ íŒ€ì„ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤."}
{"success": false, "error": "ëª¨ë“  ì°¸ê°€ìê°€ ì£¼ì ìˆœì„œë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤."}
{"success": false, "error": "AíŒ€ì˜ ì£¼ì ìˆœì„œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. 1ë¶€í„° ì—°ì†ëœ ë²ˆí˜¸ì—¬ì•¼ í•©ë‹ˆë‹¤."}
{"success": false, "error": "BíŒ€ì˜ ì£¼ì ìˆœì„œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. 1ë¶€í„° ì—°ì†ëœ ë²ˆí˜¸ì—¬ì•¼ í•©ë‹ˆë‹¤."}
```

> **ë¦´ë ˆì´ ëª¨ë“œ ê²Œì„ ì‹œì‘ ì¡°ê±´:**
> 1. ëª¨ë“  í”Œë ˆì´ì–´ ì¤€ë¹„ ì™„ë£Œ
> 2. ì–‘ íŒ€ì— ìµœì†Œ 1ëª… ì´ìƒ
> 3. ëª¨ë“  ì°¸ê°€ì(ê´€ì „ì ì œì™¸)ê°€ íŒ€ ì„ íƒ ì™„ë£Œ
> 4. ëª¨ë“  ì°¸ê°€ìê°€ ì£¼ì ìˆœì„œ ì„ íƒ ì™„ë£Œ
> 5. ê° íŒ€ì˜ ì£¼ì ìˆœì„œê°€ 1ë¶€í„° ì—°ì† (ì˜ˆ: 1,2,3 âœ“ / 1,3 âœ—)

---

### 11. ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ (ë°©ì¥ ì „ìš©)

ë ˆì´ìŠ¤ ì§„í–‰ ì¤‘ ë¼ì§€ ìœ„ì¹˜/ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

```
PUT /api/game/rooms/:roomCode/state
```

**Request Body:**
```json
{
  "playerId": "player_1704067200000_abc123",
  "status": "racing",
  "countdown": 0,
  "raceStartTime": 1704067400000,
  "raceEndTime": null,
  "pigs": [
    {"id": 0, "position": 45.5, "speed": 2.3, "status": "boost", "finishTime": null, "rank": null},
    {"id": 1, "position": 52.1, "speed": 1.8, "status": "normal", "finishTime": null, "rank": null},
    {"id": 2, "position": 100, "speed": 0, "status": "normal", "finishTime": 15234, "rank": 1}
  ]
}
```

**ë¦´ë ˆì´ ëª¨ë“œ ì—…ë°ì´íŠ¸ ì˜ˆì‹œ:**
```json
{
  "playerId": "player_1704067200000_abc123",
  "status": "racing",
  "pigs": [
    {"id": 0, "team": "A", "position": 75, "speed": 2, "status": "normal", "direction": "backward", "finishTime": null, "rank": null},
    {"id": 1, "team": "B", "position": 50, "speed": 1.5, "status": "normal", "direction": "forward", "finishTime": null, "rank": null}
  ],
  "relay": {
    "teamA": {"currentRunner": 2, "completedRunners": 1, "totalRunners": 3, "finishTime": null},
    "teamB": {"currentRunner": 1, "completedRunners": 0, "totalRunners": 3, "finishTime": null}
  }
}
```

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|------|------|:----:|------|
| playerId | string | O | ë°©ì¥ ID |
| status | GameStatus | X | ê²Œì„ ìƒíƒœ |
| countdown | number | X | ì¹´ìš´íŠ¸ë‹¤ìš´ ê°’ |
| raceStartTime | number | X | ë ˆì´ìŠ¤ ì‹œì‘ ì‹œê°„ |
| raceEndTime | number | X | ë ˆì´ìŠ¤ ì¢…ë£Œ ì‹œê°„ |
| pigs | PigState[] | X | ë¼ì§€ ìƒíƒœ ë°°ì—´ |
| relay | RelayState | X | ë¦´ë ˆì´ ëª¨ë“œ ìƒíƒœ |
| firstPlaceFinishTime | number | X | â­ **NEW** 1ë“± ê³¨ì¸ ì‹œê°„ (Unix timestamp ms), ë¦¬íƒ€ì´ì–´ ì¹´ìš´íŠ¸ë‹¤ìš´ìš© |
| resetPlayers | boolean | X | ì¬ê²½ê¸° ì‹œ í”Œë ˆì´ì–´ ì„ íƒ/ì¤€ë¹„ ì´ˆê¸°í™” |

**Response 200:**
```json
{
  "success": true,
  "data": { /* ì—…ë°ì´íŠ¸ëœ GameRoom ê°ì²´ */ }
}
```

**Response 403:**
```json
{"success": false, "error": "ë°©ì¥ë§Œ ê²Œì„ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."}
```

---

### 12. ë°© ì‚­ì œ (ë°©ì¥ ì „ìš©)

ë°©ì„ ì‚­ì œí•©ë‹ˆë‹¤.

```
DELETE /api/game/rooms/:roomCode
```

**Request Body:**
```json
{
  "playerId": "player_1704067200000_abc123"
}
```

**Response 200:**
```json
{"success": true, "data": {"message": "ë°©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."}}
```

**Response 403:**
```json
{"success": false, "error": "ë°©ì¥ë§Œ ë°©ì„ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."}
```

---

## SSE (Server-Sent Events) ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¼

### 13. ë°© ì´ë²¤íŠ¸ êµ¬ë…

ë°©ì˜ ì‹¤ì‹œê°„ ìƒíƒœ ë³€ê²½ì„ ìˆ˜ì‹ í•©ë‹ˆë‹¤. **í´ë§ ëŒ€ì‹  ë°˜ë“œì‹œ ì´ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.**

```
GET /api/game/rooms/:roomCode/events?playerId=player_123
```

**Query Parameters:**
| íŒŒë¼ë¯¸í„° | í•„ìˆ˜ | ì„¤ëª… |
|----------|:----:|------|
| playerId | O | í”Œë ˆì´ì–´ ID (ë°©ì— ì…ì¥í•œ í”Œë ˆì´ì–´ë§Œ ê°€ëŠ¥) |

**Response Headers:**
```
Content-Type: text/event-stream
Cache-Control: no-cache
Connection: keep-alive
```

---

### SSE ì´ë²¤íŠ¸ ì¢…ë¥˜

#### 1. `connected` - ì—°ê²° ì„±ê³µ

SSE ì—°ê²° ì¦‰ì‹œ í˜„ì¬ ë°© ìƒíƒœë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.

```
event: connected
data: {"roomCode":"A1B2C3","hostId":"player_123","status":"waiting","players":[...],...}

```

#### 2. `update` - ìƒíƒœ ì—…ë°ì´íŠ¸

ë°© ìƒíƒœê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì „ì†¡ë©ë‹ˆë‹¤.

```
event: update
data: {"roomCode":"A1B2C3","hostId":"player_123","status":"racing","players":[...],"pigs":[...],...}

```

#### 3. `ping` - ì—°ê²° ìœ ì§€

30ì´ˆë§ˆë‹¤ ì „ì†¡ë©ë‹ˆë‹¤. ì—°ê²° ìœ ì§€ìš©ì´ë¯€ë¡œ ë¬´ì‹œí•´ë„ ë©ë‹ˆë‹¤.

```
event: ping
data: {"timestamp":1704067200000}

```

#### 4. `room_deleted` - ë°© ì‚­ì œë¨

ë°©ì´ ì‚­ì œë˜ë©´ ì „ì†¡ë©ë‹ˆë‹¤. ì´ ì´ë²¤íŠ¸ í›„ ì—°ê²°ì´ ì¢…ë£Œë©ë‹ˆë‹¤.

```
event: room_deleted
data: {"message":"ë°©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."}

```

#### 5. `kicked` - ê°•í‡´ë¨

ë°©ì¥ì— ì˜í•´ ê°•í‡´ë˜ì—ˆì„ ë•Œ í•´ë‹¹ í”Œë ˆì´ì–´ì—ê²Œë§Œ ì „ì†¡ë©ë‹ˆë‹¤.

```
event: kicked
data: {"message":"ë°©ì¥ì— ì˜í•´ ê°•í‡´ë˜ì—ˆìŠµë‹ˆë‹¤."}

```

#### 6. `host_changed` - ê²Œì„ ì¤‘ ë°©ì¥ ë³€ê²½ âš ï¸ ì¤‘ìš”

**ê²Œì„ ì§„í–‰ ì¤‘(countdown ë˜ëŠ” racing)** ë°©ì¥ì´ í‡´ì¥í•˜ë©´ ì „ì†¡ë©ë‹ˆë‹¤.

ìƒˆ ë°©ì¥ì€ ì´ ì´ë²¤íŠ¸ë¥¼ ë°›ìœ¼ë©´ **ê²Œì„ ì—…ë°ì´íŠ¸ ë£¨í”„ë¥¼ ì¦‰ì‹œ ì‹œì‘**í•´ì•¼ í•©ë‹ˆë‹¤.

```
event: host_changed
data: {"newHostId":"player_456","room":{...ì „ì²´ ë°© ìƒíƒœ...}}

```

---

## ì—ëŸ¬ ì½”ë“œ ì •ë¦¬

### ê³µí†µ ì—ëŸ¬

| HTTP | error | ì„¤ëª… |
|:----:|-------|------|
| 400 | í”Œë ˆì´ì–´ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤. | playerId ë˜ëŠ” playerName ëˆ„ë½ |
| 400 | ë‹‰ë„¤ì„ì€ 2-10ì ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤. | playerName ê¸¸ì´ ì˜¤ë¥˜ |
| 400 | ê²Œì„ ëª¨ë“œëŠ” normal ë˜ëŠ” relayë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤. | ì˜ëª»ëœ gameMode |
| 403 | ë°©ì¥ë§Œ ê²Œì„ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. | ë¹„ë°©ì¥ì´ ì‹œì‘ ì‹œë„ |
| 403 | ë°©ì¥ë§Œ ê²Œì„ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. | ë¹„ë°©ì¥ì´ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹œë„ |
| 403 | ë°©ì¥ë§Œ ë°©ì„ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. | ë¹„ë°©ì¥ì´ ì‚­ì œ ì‹œë„ |
| 403 | ë°©ì— ì°¸ê°€í•˜ì§€ ì•Šì€ í”Œë ˆì´ì–´ì…ë‹ˆë‹¤. | SSE ì—°ê²° ì‹œ ë°©ì— ì—†ëŠ” í”Œë ˆì´ì–´ |
| 404 | ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. | ì¡´ì¬í•˜ì§€ ì•ŠëŠ” roomCode |
| 404 | í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. | ë°©ì— ì—†ëŠ” playerId |
| 409 | ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤. | maxPlayers ì´ˆê³¼ |
| 409 | ê²Œì„ì´ ì´ë¯¸ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. | ì§„í–‰ ì¤‘ ì…ì¥ ì‹œë„ |
| 409 | ì¤€ë¹„ ìƒíƒœë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. | ê²Œì„ ì¤‘ ì¤€ë¹„ í† ê¸€ ì‹œë„ |
| 409 | ê²Œì„ì„ ì‹œì‘í•  ìˆ˜ ì—†ëŠ” ìƒíƒœì…ë‹ˆë‹¤. | ì´ë¯¸ ì§„í–‰ ì¤‘ |
| 422 | ìµœì†Œ 2ëª…ì˜ í”Œë ˆì´ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤. | 1ëª…ì¼ ë•Œ ì‹œì‘ |
| 422 | ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì¤€ë¹„ë¥¼ ì™„ë£Œí•´ì•¼ í•©ë‹ˆë‹¤. | ë¯¸ì¤€ë¹„ì ì¡´ì¬ |

### ì¼ë°˜ ëª¨ë“œ ì „ìš© ì—ëŸ¬

| HTTP | error | ì„¤ëª… |
|:----:|-------|------|
| 400 | ì˜ëª»ëœ ë¼ì§€ ë²ˆí˜¸ì…ë‹ˆë‹¤. | pigIdê°€ ìœ íš¨ ë²”ìœ„ ë°– |
| 409 | ì´ë¯¸ ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ ì„ íƒí•œ ë¼ì§€ì…ë‹ˆë‹¤. | ì¤‘ë³µ ì„ íƒ |
| 409 | ë¼ì§€ë¥¼ ì„ íƒí•  ìˆ˜ ì—†ëŠ” ìƒíƒœì…ë‹ˆë‹¤. | ê²Œì„ ì¤‘ ì„ íƒ ì‹œë„ |

### ë¦´ë ˆì´ ëª¨ë“œ ì „ìš© ì—ëŸ¬ â­ NEW

| HTTP | error | ì„¤ëª… |
|:----:|-------|------|
| 400 | íŒ€ì€ A ë˜ëŠ” Bë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. | ì˜ëª»ëœ team ê°’ |
| 400 | ì£¼ì ìˆœì„œëŠ” 1 ì´ìƒì˜ ì •ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤. | 0 ì´í•˜ì˜ order ê°’ |
| 403 | ë°©ì¥ë§Œ ì£¼ì ìˆœì„œë¥¼ ë°°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. | ë¹„ë°©ì¥ì´ ìˆœì„œ ë°°ì • ì‹œë„ |
| 409 | ë¦´ë ˆì´ ëª¨ë“œì—ì„œë§Œ íŒ€ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. | ì¼ë°˜ ëª¨ë“œì—ì„œ íŒ€ ì„ íƒ ì‹œë„ |
| 409 | ë¦´ë ˆì´ ëª¨ë“œì—ì„œë§Œ ì£¼ì ìˆœì„œë¥¼ ë°°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. | ì¼ë°˜ ëª¨ë“œì—ì„œ ìˆœì„œ ë°°ì • ì‹œë„ |
| 409 | ëŒ€ê¸° ì¤‘ì¼ ë•Œë§Œ íŒ€ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. | ê²Œì„ ì¤‘ íŒ€ ë³€ê²½ ì‹œë„ |
| 409 | ëŒ€ê¸° ì¤‘ì¼ ë•Œë§Œ ì£¼ì ìˆœì„œë¥¼ ë°°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. | ê²Œì„ ì¤‘ ìˆœì„œ ë³€ê²½ ì‹œë„ |
| 409 | ê´€ì „ìëŠ” íŒ€ì„ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. | ê´€ì „ìê°€ íŒ€ ì„ íƒ ì‹œë„ |
| 422 | ê° íŒ€ì— ìµœì†Œ 1ëª…ì˜ í”Œë ˆì´ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤. | í•œ íŒ€ì— 0ëª…ì¸ ìƒíƒœë¡œ ì‹œì‘ ì‹œë„ |
| 422 | ëª¨ë“  ì°¸ê°€ìê°€ íŒ€ì„ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤. | íŒ€ ë¯¸ì„ íƒ ì°¸ê°€ì ì¡´ì¬ |
| 422 | ëª¨ë“  ì°¸ê°€ìê°€ ì£¼ì ìˆœì„œë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤. | ìˆœì„œ ë¯¸ì„ íƒ ì°¸ê°€ì ì¡´ì¬ |
| 422 | AíŒ€ì˜ ì£¼ì ìˆœì„œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. 1ë¶€í„° ì—°ì†ëœ ë²ˆí˜¸ì—¬ì•¼ í•©ë‹ˆë‹¤. | ìˆœì„œ ë¹„ì—°ì† (ì˜ˆ: 1,3) |
| 422 | BíŒ€ì˜ ì£¼ì ìˆœì„œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. 1ë¶€í„° ì—°ì†ëœ ë²ˆí˜¸ì—¬ì•¼ í•©ë‹ˆë‹¤. | ìˆœì„œ ë¹„ì—°ì† (ì˜ˆ: 1,3) |

---

## ê²Œì„ íë¦„ë„

### ì¼ë°˜ ëª¨ë“œ (Normal Mode)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ë°© ìƒì„±/ì…ì¥                                                 â”‚
â”‚     POST /rooms (ë°©ì¥) ë˜ëŠ” POST /rooms/:code/join (ì°¸ê°€ì)      â”‚
â”‚     â†’ ì‘ë‹µìœ¼ë¡œ ë°›ì€ roomCodeë¡œ SSE ì—°ê²°                          â”‚
â”‚     GET /rooms/:code/events?playerId=xxx                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ëŒ€ê¸°ì‹¤ (status: "waiting")                                   â”‚
â”‚     - SSEë¡œ ì‹¤ì‹œê°„ í”Œë ˆì´ì–´ ëª©ë¡ ë™ê¸°í™”                           â”‚
â”‚     - POST /rooms/:code/select-pig (ë¼ì§€ ì„ íƒ)                   â”‚
â”‚     - POST /rooms/:code/ready (ì¤€ë¹„ ì™„ë£Œ)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ê²Œì„ ì‹œì‘ (ë°©ì¥ë§Œ)                                           â”‚
â”‚     POST /rooms/:code/start                                      â”‚
â”‚     â†’ status: "countdown"                                        â”‚
â”‚     â†’ SSEë¡œ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì— ì „íŒŒ                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ì¹´ìš´íŠ¸ë‹¤ìš´ (status: "countdown")                             â”‚
â”‚     ë°©ì¥ì´ PUT /rooms/:code/stateë¡œ countdown: 3â†’2â†’1â†’0          â”‚
â”‚     â†’ SSEë¡œ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì— ì „íŒŒ                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. ë ˆì´ìŠ¤ (status: "racing")                                    â”‚
â”‚     ë°©ì¥ì´ 100msë§ˆë‹¤ PUT /rooms/:code/stateë¡œ pigs ì—…ë°ì´íŠ¸      â”‚
â”‚     â†’ SSEë¡œ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì— ì „íŒŒ                               â”‚
â”‚     â†’ ì°¸ê°€ìëŠ” SSEë¡œ ë°›ì€ pigs ë°ì´í„°ë¡œ í™”ë©´ ë Œë”ë§              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. ì¢…ë£Œ (status: "finished")                                    â”‚
â”‚     ëª¨ë“  ë¼ì§€ ì™„ì£¼ ì‹œ ë°©ì¥ì´ status: "finished" ì—…ë°ì´íŠ¸         â”‚
â”‚     â†’ ê²°ê³¼ í™”ë©´ í‘œì‹œ                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë¦´ë ˆì´ ëª¨ë“œ (Relay Mode) â­ NEW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ë°© ìƒì„± (gameMode: "relay")                                  â”‚
â”‚     POST /rooms { ..., gameMode: "relay" }                       â”‚
â”‚     â†’ ë¼ì§€ 2ë§ˆë¦¬ ìë™ ìƒì„± (AíŒ€, BíŒ€ ê° 1ë§ˆë¦¬)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ë¼ì§€ ìƒ‰ìƒ ì„ íƒ                                               â”‚
â”‚     POST /rooms/:code/select-pig { pigId: 5 }                    â”‚
â”‚     â†’ ê° í”Œë ˆì´ì–´ê°€ ì›í•˜ëŠ” ìƒ‰ìƒ ì„ íƒ (30ê°€ì§€)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. íŒ€ ì„ íƒ                                                      â”‚
â”‚     POST /rooms/:code/select-team { team: "A" }                  â”‚
â”‚     â†’ ê° í”Œë ˆì´ì–´ê°€ AíŒ€ ë˜ëŠ” BíŒ€ ì„ íƒ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ì¤€ë¹„ ì™„ë£Œ                                                    â”‚
â”‚     POST /rooms/:code/ready                                      â”‚
â”‚     â†’ ëª¨ë“  ì°¸ê°€ì ì¤€ë¹„ ì™„ë£Œ í•„ìš”                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. ì£¼ì ìˆœì„œ ëœë¤ ë°°ì • + ê²Œì„ ì‹œì‘ (ë°©ì¥ë§Œ)                     â”‚
â”‚     POST /rooms/:code/assign-runner-orders                       â”‚
â”‚     â†’ ë°©ì¥ì´ ëœë¤ ìˆœì„œ ìƒì„± í›„ ì¼ê´„ ë°°ì •                         â”‚
â”‚     POST /rooms/:code/start                                      â”‚
â”‚     â†’ relay.teamA/B.totalRunners ìë™ ì„¤ì •                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. ë¦´ë ˆì´ ë ˆì´ìŠ¤ (status: "racing") ğŸƒ                          â”‚
â”‚                                                                  â”‚
â”‚     [1ë²ˆ ì£¼ì ì™•ë³µ]                                              â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚     â”‚ AíŒ€ 1ë²ˆ: 0 â”€â”€forwardâ”€â”€â†’ 100 â”€â”€backwardâ”€â”€â†’ 0    â”‚          â”‚
â”‚     â”‚ BíŒ€ 1ë²ˆ: 0 â”€â”€forwardâ”€â”€â†’ 100 â”€â”€backwardâ”€â”€â†’ 0    â”‚          â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚              â†“ ì™•ë³µ ì™„ë£Œ ì‹œ ë°”í†µ ì „ë‹¬                            â”‚
â”‚     [2ë²ˆ ì£¼ì ì™•ë³µ]                                              â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚     â”‚ AíŒ€ 2ë²ˆ: 0 â”€â”€forwardâ”€â”€â†’ 100 â”€â”€backwardâ”€â”€â†’ 0    â”‚          â”‚
â”‚     â”‚ BíŒ€ 2ë²ˆ: 0 â”€â”€forwardâ”€â”€â†’ 100 â”€â”€backwardâ”€â”€â†’ 0    â”‚          â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚              â†“ ... ë§ˆì§€ë§‰ ì£¼ìê¹Œì§€ ë°˜ë³µ                          â”‚
â”‚                                                                  â”‚
â”‚     [ìƒíƒœ ì—…ë°ì´íŠ¸ ë°ì´í„° ì˜ˆì‹œ]                                   â”‚
â”‚     pigs[0]: {team:"A", position:75, direction:"backward"}       â”‚
â”‚     pigs[1]: {team:"B", position:50, direction:"forward"}        â”‚
â”‚     relay.teamA: {currentRunner:2, completedRunners:1}           â”‚
â”‚     relay.teamB: {currentRunner:1, completedRunners:0}           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. ì¢…ë£Œ (status: "finished")                                    â”‚
â”‚     í•œ íŒ€ì˜ ë§ˆì§€ë§‰ ì£¼ìê°€ ë¨¼ì € ì™•ë³µ ì™„ë£Œ ì‹œ                      â”‚
â”‚     â†’ relay.teamA/B.finishTime ì„¤ì •                              â”‚
â”‚     â†’ pigs[].rankë¡œ íŒ€ ìˆœìœ„ í‘œì‹œ (1ë“±/2ë“±)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì¼ë°˜ ëª¨ë“œ í…ŒìŠ¤íŠ¸

```bash
# 1. ë°© ìƒì„± (ì¼ë°˜ ëª¨ë“œ)
curl -X POST http://localhost:5000/api/game/rooms \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_a","playerName":"í˜¸ìŠ¤íŠ¸","gameMode":"normal"}'

# 2. SSE ì—°ê²° (roomCode = A1B2C3)
curl -N "http://localhost:5000/api/game/rooms/A1B2C3/events?playerId=player_a"

# 3. ë°© ì…ì¥ (ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ)
curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/join \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_b","playerName":"ì°¸ê°€ì"}'
# â†’ ìœ„ì˜ SSE ì—°ê²°ì—ì„œ event: update ìˆ˜ì‹ ë¨

# 4. ë¼ì§€ ì„ íƒ
curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/select-pig \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_a","pigId":0}'

# 5. ì¤€ë¹„ ì™„ë£Œ
curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/ready \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_b"}'

# 6. ê²Œì„ ì‹œì‘
curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/start \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_a"}'
```

### ë¦´ë ˆì´ ëª¨ë“œ í…ŒìŠ¤íŠ¸ â­ NEW

```bash
# 1. ë¦´ë ˆì´ ëª¨ë“œ ë°© ìƒì„±
curl -X POST http://localhost:5000/api/game/rooms \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_a","playerName":"í˜¸ìŠ¤íŠ¸","gameMode":"relay","maxPlayers":10}'

# 2. SSE ì—°ê²°
curl -N "http://localhost:5000/api/game/rooms/A1B2C3/events?playerId=player_a"

# 3. ë‹¤ë¥¸ í”Œë ˆì´ì–´ ì…ì¥
curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/join \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_b","playerName":"ì°¸ê°€ì1"}'

curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/join \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_c","playerName":"ì°¸ê°€ì2"}'

curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/join \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_d","playerName":"ì°¸ê°€ì3"}'

# 4. ë¼ì§€ ìƒ‰ìƒ ì„ íƒ (ê°ì)
curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/select-pig \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_a","pigId":0}'

curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/select-pig \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_b","pigId":5}'

curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/select-pig \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_c","pigId":10}'

curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/select-pig \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_d","pigId":15}'

# 5. íŒ€ ì„ íƒ (AíŒ€ 2ëª…, BíŒ€ 2ëª…)
curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/select-team \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_a","team":"A"}'

curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/select-team \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_b","team":"A"}'

curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/select-team \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_c","team":"B"}'

curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/select-team \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_d","team":"B"}'

# 6. ì¤€ë¹„ ì™„ë£Œ (ë°©ì¥ ì œì™¸ ëª¨ë“  í”Œë ˆì´ì–´)
curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/ready \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_b"}'

curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/ready \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_c"}'

curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/ready \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_d"}'

# 7. ì£¼ì ìˆœì„œ ë°°ì • (ë°©ì¥ì´ ëœë¤ ìˆœì„œë¡œ)
curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/assign-runner-orders \
  -H "Content-Type: application/json" \
  -d '{
    "playerId":"player_a",
    "assignments":[
      {"playerId":"player_a","order":1},
      {"playerId":"player_b","order":2},
      {"playerId":"player_c","order":1},
      {"playerId":"player_d","order":2}
    ]
  }'

# 8. ê²Œì„ ì‹œì‘
curl -X POST http://localhost:5000/api/game/rooms/A1B2C3/start \
  -H "Content-Type: application/json" \
  -d '{"playerId":"player_a"}'
# â†’ relay.teamA/B.totalRunnersê°€ ìë™ìœ¼ë¡œ ì„¤ì •ë¨

# 9. ë¦´ë ˆì´ ìƒíƒœ ì—…ë°ì´íŠ¸ (ë°©ì¥ë§Œ, ë ˆì´ìŠ¤ ì¤‘)
curl -X PUT http://localhost:5000/api/game/rooms/A1B2C3/state \
  -H "Content-Type: application/json" \
  -d '{
    "playerId":"player_a",
    "status":"racing",
    "pigs":[
      {"id":0,"team":"A","position":50,"speed":2,"status":"normal","direction":"forward","finishTime":null,"rank":null},
      {"id":1,"team":"B","position":75,"speed":1.5,"status":"normal","direction":"forward","finishTime":null,"rank":null}
    ],
    "relay":{
      "teamA":{"currentRunner":1,"completedRunners":0,"totalRunners":2,"finishTime":null},
      "teamB":{"currentRunner":1,"completedRunners":0,"totalRunners":2,"finishTime":null}
    }
  }'
```

---

### 14. í•˜íŠ¸ë¹„íŠ¸ (í”Œë ˆì´ì–´ í™œì„± ìƒíƒœ ê°±ì‹ ) â­ NEW

í´ë¼ì´ì–¸íŠ¸ê°€ ì£¼ê¸°ì ìœ¼ë¡œ í•˜íŠ¸ë¹„íŠ¸ë¥¼ ì „ì†¡í•˜ì—¬ í™œì„± ìƒíƒœì„ì„ ì„œë²„ì— ì•Œë¦½ë‹ˆë‹¤.
ì„œë²„ëŠ” ì¼ì • ì‹œê°„ ë™ì•ˆ í•˜íŠ¸ë¹„íŠ¸ê°€ ì—†ëŠ” í”Œë ˆì´ì–´ë¥¼ ë¹„í™œì„±ìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬ ìë™ìœ¼ë¡œ ë°©ì—ì„œ ì œê±°í•©ë‹ˆë‹¤.

```
POST /api/game/rooms/:roomCode/heartbeat
```

**Request Body:**
```json
{
  "playerId": "player_1704067200000_abc123"
}
```

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|------|------|:----:|------|
| playerId | string | O | í”Œë ˆì´ì–´ ID |

**Response 200:**
```json
{
  "success": true,
  "data": {
    "message": "í•˜íŠ¸ë¹„íŠ¸ ìˆ˜ì‹  ì™„ë£Œ"
  }
}
```

**Response 404:**
```json
{"success": false, "error": "ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}
{"success": false, "error": "í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}
```

**í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„:**
- ë°© ì…ì¥ í›„ ì¦‰ì‹œ í•˜íŠ¸ë¹„íŠ¸ 1íšŒ ì „ì†¡
- ì´í›„ **10ì´ˆë§ˆë‹¤** í•˜íŠ¸ë¹„íŠ¸ ì „ì†¡
- ë°© í‡´ì¥, ê°•í‡´, ì—°ê²° ì¢…ë£Œ ì‹œ í•˜íŠ¸ë¹„íŠ¸ ì¤‘ì§€

**ì„œë²„ êµ¬í˜„ ìš”êµ¬ì‚¬í•­:**

1. **Player íƒ€ì…ì— lastHeartbeat í•„ë“œ ì¶”ê°€:**
```typescript
interface Player {
  // ... ê¸°ì¡´ í•„ë“œë“¤
  lastHeartbeat: number;  // ë§ˆì§€ë§‰ í•˜íŠ¸ë¹„íŠ¸ ì‹œê°„ (Unix timestamp ms)
}
```

2. **í•˜íŠ¸ë¹„íŠ¸ ìˆ˜ì‹  ì‹œ ì²˜ë¦¬:**
```javascript
function handleHeartbeat(roomCode, playerId) {
  const room = getRoom(roomCode);
  if (!room) throw new NotFoundError('ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

  const player = room.players.find(p => p.id === playerId);
  if (!player) throw new NotFoundError('í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

  // ë§ˆì§€ë§‰ í•˜íŠ¸ë¹„íŠ¸ ì‹œê°„ ê°±ì‹ 
  player.lastHeartbeat = Date.now();
  room.updatedAt = Date.now();

  saveRoom(roomCode, room);

  return { message: 'í•˜íŠ¸ë¹„íŠ¸ ìˆ˜ì‹  ì™„ë£Œ' };
}
```

3. **ë¹„í™œì„± í”Œë ˆì´ì–´ ìë™ ì œê±° (ê¶Œì¥: 15ì´ˆ íƒ€ì„ì•„ì›ƒ):**
```javascript
// ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ (ì˜ˆ: 5ì´ˆë§ˆë‹¤)
function cleanupInactivePlayers() {
  const HEARTBEAT_TIMEOUT = 15000; // 15ì´ˆ
  const now = Date.now();

  for (const roomCode of getAllRoomCodes()) {
    const room = getRoom(roomCode);
    if (!room) continue;

    // ëŒ€ê¸° ì¤‘ì´ê±°ë‚˜ ê²Œì„ ì¤‘ì¼ ë•Œë§Œ ì²´í¬
    if (room.status === 'waiting' || room.status === 'selecting') {
      const inactivePlayers = room.players.filter(
        p => now - (p.lastHeartbeat || p.joinedAt) > HEARTBEAT_TIMEOUT
      );

      for (const player of inactivePlayers) {
        console.log(`[Heartbeat] ë¹„í™œì„± í”Œë ˆì´ì–´ ì œê±°: ${player.name} (${player.id})`);

        // í”Œë ˆì´ì–´ ì œê±° ë¡œì§ (leaveì™€ ë™ì¼)
        removePlayerFromRoom(roomCode, player.id);
      }
    }
  }
}

// 5ì´ˆë§ˆë‹¤ ì‹¤í–‰
setInterval(cleanupInactivePlayers, 5000);
```

4. **ë°© ì…ì¥ ì‹œ lastHeartbeat ì´ˆê¸°í™”:**
```javascript
function joinRoom(roomCode, playerId, playerName) {
  // ... ê¸°ì¡´ ë¡œì§

  const newPlayer = {
    id: playerId,
    name: playerName,
    selectedPig: null,
    isReady: false,
    isSpectator: false,
    team: null,
    runnerOrder: null,
    joinedAt: Date.now(),
    lastHeartbeat: Date.now()  // ì…ì¥ ì‹œ ì´ˆê¸°í™”
  };

  room.players.push(newPlayer);
  // ...
}
```

5. **SSE ì´ë²¤íŠ¸ ì „íŒŒ:**
ë¹„í™œì„± í”Œë ˆì´ì–´ê°€ ì œê±°ë˜ë©´ `update` ì´ë²¤íŠ¸ë¥¼ ì „íŒŒí•˜ì—¬ ë‹¤ë¥¸ í”Œë ˆì´ì–´ë“¤ì—ê²Œ ì•Œë¦½ë‹ˆë‹¤.

**íƒ€ì„ì•„ì›ƒ ì„¤ì • ê¶Œì¥ê°’:**
| í•­ëª© | ê°’ | ì„¤ëª… |
|------|-----|------|
| í´ë¼ì´ì–¸íŠ¸ í•˜íŠ¸ë¹„íŠ¸ ì£¼ê¸° | 10ì´ˆ | `setInterval(() => sendHeartbeat(roomCode), 10000)` |
| ì„œë²„ íƒ€ì„ì•„ì›ƒ | 15ì´ˆ | í•˜íŠ¸ë¹„íŠ¸ ì£¼ê¸°ì˜ 1.5ë°° (ë„¤íŠ¸ì›Œí¬ ì§€ì—° ê³ ë ¤) |
| ì„œë²„ ì²´í¬ ì£¼ê¸° | 5ì´ˆ | ë¹„í™œì„± í”Œë ˆì´ì–´ ì²´í¬ ê°„ê²© |

> **ì°¸ê³ **: ê²Œì„ ì§„í–‰ ì¤‘(countdown, racing, finished)ì—ëŠ” í•˜íŠ¸ë¹„íŠ¸ íƒ€ì„ì•„ì›ƒì„ ì ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ê²Œì„ ì¤‘ì—ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ê²Œì„ ë¡œì§ì— ì§‘ì¤‘í•˜ë¯€ë¡œ í•˜íŠ¸ë¹„íŠ¸ê°€ ì§€ì—°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ì£¼ìš” íŠ¹ì§•

1. **SSE ì‹¤ì‹œê°„ ë™ê¸°í™”**: í´ë§ ëŒ€ë¹„ ì„œë²„ ë¶€í•˜ 90% ê°ì†Œ
2. **ë°©ì¥ ê¶Œí•œ ì‹œìŠ¤í…œ**: ê²Œì„ ì‹œì‘, ìƒíƒœ ì—…ë°ì´íŠ¸, ë°© ì‚­ì œëŠ” ë°©ì¥ë§Œ ê°€ëŠ¥
3. **ìë™ ì •ë¦¬**: 30ë¶„ ì´ìƒ ì—…ë°ì´íŠ¸ ì—†ëŠ” ë°© ìë™ ì‚­ì œ
4. **ë°©ì¥ ìœ„ì„**: ë°©ì¥ í‡´ì¥ ì‹œ ê°€ì¥ ë¨¼ì € ì…ì¥í•œ í”Œë ˆì´ì–´ë¡œ ìë™ ìœ„ì„
5. **ë™ì  ë¼ì§€ ìˆ˜ (ì¼ë°˜ ëª¨ë“œ)**: í”Œë ˆì´ì–´ ìˆ˜ = ë¼ì§€ ìˆ˜ (ì…ì¥ ì‹œ ì¶”ê°€, í‡´ì¥ ì‹œ ì œê±°)
6. **ê³ ì • ë¼ì§€ ìˆ˜ (ë¦´ë ˆì´ ëª¨ë“œ)**: íŒ€ë‹¹ 1ë§ˆë¦¬, ì´ 2ë§ˆë¦¬ ê³ ì •
7. **ìµœëŒ€ 30ëª…**: ìµœëŒ€ 30ëª…ê¹Œì§€ í”Œë ˆì´ ê°€ëŠ¥
8. **2ê°€ì§€ ê²Œì„ ëª¨ë“œ**: ì¼ë°˜(normal) / ë¦´ë ˆì´(relay) ëª¨ë“œ ì§€ì›
9. **ë¦´ë ˆì´ ì™•ë³µ ë ˆì´ìŠ¤**: ê° ì£¼ìê°€ ì¶œë°œâ†’ê²°ìŠ¹â†’ì¶œë°œ ì™•ë³µ í›„ ë‹¤ìŒ ì£¼ì ì¶œë°œ
10. **ëœë¤ ì£¼ì ìˆœì„œ**: ë°©ì¥ì´ ê²Œì„ ì‹œì‘ ì‹œ íŒ€ ë‚´ ì£¼ì ìˆœì„œë¥¼ ëœë¤ ë°°ì •
11. **í•˜íŠ¸ë¹„íŠ¸ ê¸°ë°˜ í”Œë ˆì´ì–´ ê´€ë¦¬**: ë¹„í™œì„± í”Œë ˆì´ì–´ ìë™ ì œê±° (15ì´ˆ íƒ€ì„ì•„ì›ƒ)

---

## ë³€ê²½ ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ë³€ê²½ ë‚´ìš© |
|------|------|----------|
| v1.0 | 2024-01-01 | ìµœì´ˆ ì‘ì„± (í´ë§ ë°©ì‹) |
| v2.0 | 2024-01-08 | SSE ë°©ì‹ìœ¼ë¡œ ì „í™˜, CORS ì„¤ì • ì¶”ê°€, ì™„ì „í•œ ì„œë²„ êµ¬í˜„ ì˜ˆì‹œ ì¶”ê°€ |
| v2.1 | 2025-01-08 | ë¼ì§€ ì„ íƒ í•´ì œ ê¸°ëŠ¥ ì¶”ê°€, ì¬ê²½ê¸° ì‹œ í”Œë ˆì´ì–´ ì´ˆê¸°í™” ì˜µì…˜ ì¶”ê°€, ê²Œì„ ì¤‘ ë°©ì¥ ë³€ê²½ ì‹œ host_changed ì´ë²¤íŠ¸ ì¶”ê°€ |
| v3.0 | 2025-01-09 | **ë¦´ë ˆì´ ëª¨ë“œ ì¶”ê°€**: íŒ€ ëŒ€í•­ì „, ì™•ë³µ ë ˆì´ìŠ¤, ì£¼ì ìˆœì„œ ì¼ê´„ ë°°ì • API ì¶”ê°€ |
| v3.1 | 2025-01-09 | **íŒ€ì „ ëª¨ë“œ ê°•í™”**: íŒ€ ì¸ì› ê· í˜• í•„ìˆ˜, ë¦¬íƒ€ì´ì–´ ê·œì¹™ ì¶”ê°€ (1ë“± ê³¨ì¸ í›„ 10ì´ˆ), `firstPlaceFinishTime` í•„ë“œ ì¶”ê°€, ë™ì  ì‹œ 1ë“± ë³´ìœ íŒ€ ìŠ¹ë¦¬ |
